<?xml version="1.0" encoding="UTF-8"?>
<?asciidoc-toc maxdepth="4"?>
<?asciidoc-numbered?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
<info>
<title>{root-project-name} ({project-version})</title>
<date>2018-06-27 01:10:56 UTC</date>
<author>
<personname>
<firstname>Maksim</firstname>
<surname>Kostromin</surname>
</personname>
<email>daggerok@gmail.com</email>
</author>
<authorinitials>MK</authorinitials>
<revhistory>
<revision>
<revnumber>{project-version}</revnumber>
<date>2018-06-27 01:10:56 UTC</date>
<authorinitials>MK</authorinitials>
</revision>
</revhistory>
</info>
<preface>
<title></title>
<simpara>Travis CI status:
<inlinemediaobject>
<imageobject>
<imagedata fileref="https://travis-ci.org/daggerok/{root-project-name}.svg?branch=master"/>
</imageobject>
<textobject><phrase>Build Status</phrase></textobject>
</inlinemediaobject></simpara>
</preface>
<chapter xml:id="_introduction">
<title>Introduction</title>
<simpara>Read GitHub pages <link xl:href="https://daggerok.github.io/thymeleaf-ee">project reference documentation</link></simpara>
<simpara>generated by <link xl:href="https://github.com/daggerok/generator-jvm/">generator-jvm</link> yeoman generator (java-ee)</simpara>
</chapter>
<chapter xml:id="_implementation">
<title>Implementation</title>
<section xml:id="_create_java_ee_project">
<title>create Java EE project</title>
<formalpara>
<title>I&#8217;m using my yo <literal>generator-jvm</literal> generator package (type: <literal>java-ee</literal>, name <literal>thymeleaf-ee</literal>):</title>
<para>
<programlisting language="bash" linenumbering="unnumbered">npm i -g yo generator generator-jvm
yo jvm -t java-ee -n thymeleaf-ee</programlisting>
</para>
</formalpara>
<formalpara>
<title>beans.xml</title>
<para>
<programlisting language="xml" linenumbering="unnumbered">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- CDI 1.1 webapp/WEB-INF/beans.xml --&gt;
&lt;!-- J2EE 1.2: http://www.oracle.com/webfolder/technetwork/jsc/j2ee/dtds/index.html --&gt;
&lt;!-- J2EE 1.3: http://www.oracle.com/webfolder/technetwork/jsc/dtd/index.html --&gt;
&lt;!-- J2EE 1.4: http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/j2ee/index.html --&gt;
&lt;!-- Java EE 5: http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/index.html#5 --&gt;
&lt;!-- Java EE 6: http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/index.html#6 --&gt;
&lt;!-- Java EE 7: http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/index.html#7 --&gt;
&lt;!-- Java EE 8: http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/index.html#8 --&gt;
&lt;beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="http://xmlns.jcp.org/xml/ns/javaee"
       xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd"
       bean-discovery-mode="all"&gt;
&lt;/beans&gt;</programlisting>
</para>
</formalpara>
</section>
<section xml:id="_add_thymeleaf_and_mvc_1_0_spec_dependencies">
<title>add thymeleaf and mvc 1.0 spec dependencies</title>
<formalpara>
<title>maven</title>
<para>
<programlisting language="xml" linenumbering="unnumbered"></programlisting>
</para>
</formalpara>
<formalpara>
<title>gardle</title>
<para>
<programlisting language="groovy" linenumbering="unnumbered">allprojects {
  dependencies {
    implementation 'javax.mvc:javax.mvc-api:1.0-pr'
    implementation 'org.mvc-spec.ozark:ozark-resteasy:1.0.0-m03'
    implementation 'org.mvc-spec.ozark.ext:ozark-thymeleaf:1.0.0-m03', {
      exclude group: 'org.thymeleaf', module: 'thymeleaf'
    }
    implementation 'org.thymeleaf:thymeleaf:3.0.9.RELEASE'
    /*
    implementation 'org.thymeleaf.extras:thymeleaf-extras-java8time:3.0.1.RELEASE',
        'org.thymeleaf.extras:thymeleaf-extras-tiles2:2.1.1.RELEASE',
        'org.thymeleaf.extras:thymeleaf-extras-conditionalcomments:2.1.2.RELEASE'
    testImplementation 'org.thymeleaf:thymeleaf-testing:3.0.3.RELEASE'
    */
  }
}</programlisting>
</para>
</formalpara>
</section>
<section xml:id="_configure_thymeleaf">
<title>configure thymeleaf</title>
<formalpara>
<title>configure Thymeleaf view resolver</title>
<para>
<programlisting language="java" linenumbering="unnumbered">@Slf4j
@ApplicationScoped
public class ThymeleafViewEngine extends ViewEngineBase {

  @Inject ServletContext servletContext;
  TemplateEngine engine;

  @Override
  public boolean supports(final String view) {
    return !view.contains(".");
  }

  @PostConstruct
  public void postConstruct() {
    final ServletContextTemplateResolver resolver = new ServletContextTemplateResolver(servletContext);
    resolver.setPrefix("/WEB-INF/layouts/");
    resolver.setSuffix(".html");
    resolver.setTemplateMode(TemplateMode.HTML);
    resolver.setCacheable(false);
    engine = new TemplateEngine();
    engine.setTemplateResolver(resolver);
  }

  @Override
  public void processView(ViewEngineContext context) throws ViewEngineException {
    Try.of(() -&gt; {

      final HttpServletRequest request = context.getRequest();
      final HttpServletResponse response = context.getResponse();

      final WebContext webContext = new WebContext(request, response, servletContext, request.getLocale());
      webContext.setVariables(context.getModels());
      request.setAttribute("view", context.getView());

      final String template = "default";
      engine.process(template, webContext, response.getWriter());

      return template; // not needed, just because we are using vavr Try.of()

    }).getOrElseThrow(ViewEngineException::new);
  }
}</programlisting>
</para>
</formalpara>
</section>
<section xml:id="_create_mvc_controller">
<title>create MVC controller</title>
<formalpara>
<title>resteasy controller</title>
<para>
<programlisting language="java" linenumbering="unnumbered">@Path("")
@Controller
@Produces(TEXT_HTML)
public class IndexPage {

  @Inject Models models;

  @GET
  @Path("")
  public String indexView() {
    models.put("message", "Hello, World!");
    models.put("data", List.of("ololo", "trololo").toJavaList());
    return "index";
  }
}</programlisting>
</para>
</formalpara>
</section>
<section xml:id="_add_default_basic_pages_layout">
<title>add default (basic) pages layout</title>
<formalpara>
<title>Thymeleaf default layout template in <literal>src/main/resources/webapp/WEB-INF/layouts/default.html</literal> file:</title>
<para>
<programlisting language="html" linenumbering="unnumbered">&lt;!doctype html&gt;
&lt;html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=Edge" /&gt;
  &lt;title&gt;Template | Thymeleaf EE&lt;/title&gt;
  &lt;link rel="icon" type="image/x-icon" th:href="@{/assets/favicon.ico}" /&gt;
  &lt;link rel="stylesheet" type="text/css" th:href="@{/assets/styles.css}" /&gt;
  &lt;!-- custom styles will be added here...--&gt;
  &lt;th:block th:include="${view} :: header" /&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div th:text="${message}"&gt;Here should be some basic message...&lt;/div&gt;
&lt;ul th:each="item : ${data}"&gt;
  &lt;li th:text="${item}"&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;!-- custom view specific stuff: --&gt;
&lt;div th:replace="${view} :: content"&gt;&lt;/div&gt;

&lt;script th:src="@{/assets/scripts.js}"&gt;&lt;/script&gt;
&lt;!-- custom scripts will be added here...--&gt;
&lt;th:block th:include="${view} :: footer" /&gt;
&lt;/body&gt;
&lt;/html&gt;</programlisting>
</para>
</formalpara>
</section>
<section xml:id="_and_finally_create_view_for_index_page">
<title>and finally create view for index page</title>
<formalpara>
<title>Thymeleaf index view template (file <literal>src/main/resources/webapp/WEB-INF/layouts/index.html</literal>):</title>
<para>
<programlisting language="html" linenumbering="unnumbered">&lt;!DOCTYPE html&gt;
&lt;html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
  &lt;title&gt;Hello | Thymeleaf EE&lt;/title&gt;
  &lt;div th:fragment="header" th:remove="tag"&gt;
    &lt;!-- here some my styles.... --&gt;
  &lt;/div&gt;
&lt;/head&gt;
&lt;body th:fragment="content"&gt;
&lt;h1&gt;Hello!&lt;/h1&gt;
&lt;div th:fragment="footer" th:remove="tag"&gt;
  &lt;!-- here some my scripts.... --&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</programlisting>
</para>
</formalpara>
</section>
</chapter>
<chapter xml:id="_links">
<title>Links</title>
<itemizedlist>
<listitem>
<simpara><link xl:href="{github-url}">GitHub repo</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://daggerok.github.io/{root-project-name}">GitHub pages</link></simpara>
</listitem>
</itemizedlist>
</chapter>
<chapter xml:id="_other_links">
<title>Other links</title>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://dzone.com/articles/thymeleaf-with-javaee-8">DZone: Thymeleaf With JavaEE 8 article</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://www.mvc-spec.org/ozark/docs/install-javaee.html">JSR 371: Model-View-Controller Specification</link></simpara>
</listitem>
</itemizedlist>
</chapter>
</book>